/*! contact-data-services.js | https://github.com/experianplc/Experian-Address-Validation | Apache-2.0
*   Experian | https://github.com/experianplc */

!function(s,o,r){"use strict";var d=s.ContactDataServices=s.ContactDataServices||{};d.defaults={input:{placeholderText:"Start typing an address...",applyFocus:!1},formattedAddressContainer:{showHeading:!1,headingType:"h3",validatedHeadingText:"Validated address",manualHeadingText:"Manual address entered"},searchAgain:{visible:!0,text:"Search again"},manualEntry:{visible:!0,text:"<a class='btn btn-primary'>Enter address manually</a>"},infoAlert:{visible:!0,text:"More results are available",popoverBtn:{visible:!0,title:"",text:"",icon:"<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-info-circle-fill' viewBox='0 0 16 16'> <path d='M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z'/> </svg>"}},useSpinner:!1,language:"en",addressLineLabels:["address_line_1","address_line_2","address_line_3","locality","region","postal_code","country"]},d.mergeDefaultOptions=function(e){var t=e||{};return t.enabled=!0,t.language=t.language||d.defaults.language,t.useSpinner=t.useSpinner||d.defaults.useSpinner,t.lastSearchTerm="",t.currentSearchTerm="",t.lastCountryCode="",t.currentCountryCode="",t.currentSearchUrl="",t.currentFormatUrl="",t.applyFocus=void 0!==t.applyFocus?t.applyFocus:d.defaults.input.applyFocus,t.placeholderText=t.placeholderText||d.defaults.input.placeholderText,t.searchAgain=t.searchAgain||{},t.searchAgain.visible=void 0!==t.searchAgain.visible?t.searchAgain.visible:d.defaults.searchAgain.visible,t.searchAgain.text=t.searchAgain.text||d.defaults.searchAgain.text,t.formattedAddressContainer=t.formattedAddressContainer||d.defaults.formattedAddressContainer,t.formattedAddressContainer.showHeading=void 0!==t.formattedAddressContainer.showHeading?t.formattedAddressContainer.showHeading:d.defaults.formattedAddressContainer.showHeading,t.formattedAddressContainer.headingType=t.formattedAddressContainer.headingType||d.defaults.formattedAddressContainer.headingType,t.formattedAddressContainer.validatedHeadingText=t.formattedAddressContainer.validatedHeadingText||d.defaults.formattedAddressContainer.validatedHeadingText,t.formattedAddressContainer.manualHeadingText=t.formattedAddressContainer.manualHeadingText||d.defaults.formattedAddressContainer.manualHeadingText,t.elements=t.elements||{},t.manualEntry=t.manualEntry||{},t.manualEntry.visible=void 0!==t.manualEntry.visible?t.manualEntry.visible:d.defaults.manualEntry.visible,t.manualEntry.text=t.manualEntry.text||d.defaults.manualEntry.text,t.infoAlert=t.infoAlert||{},t.infoAlert.visible=void 0!==t.infoAlert.visible?t.infoAlert.visible:d.defaults.infoAlert.visible,t.infoAlert.text=void 0!==t.infoAlert.text?t.infoAlert.text:d.defaults.infoAlert.text,t.infoAlert.popoverBtn=t.infoAlert.popoverBtn||{},t.infoAlert.popoverBtn.visible=void 0!==t.infoAlert.popoverBtn.visible?t.infoAlert.popoverBtn.visible:d.defaults.infoAlert.popoverBtn.visible,t.infoAlert.popoverBtn.text=void 0!==t.infoAlert.popoverBtn.text?t.infoAlert.popoverBtn.text:d.defaults.infoAlert.popoverBtn.text,t.infoAlert.popoverBtn.title=void 0!==t.infoAlert.popoverBtn.title?t.infoAlert.popoverBtn.title:d.defaults.infoAlert.popoverBtn.title,t.infoAlert.popoverBtn.icon=void 0!==t.infoAlert.popoverBtn.icon?t.infoAlert.popoverBtn.icon:d.defaults.infoAlert.popoverBtn.icon,t},d.eventFactory=function(){var s={collection:{},on:function(e,t){s.collection[e]=s.collection[e]||[],s.collection[e].push(t)},trigger:function(e,t){if(s.collection[e])for(var r=0;r<s.collection[e].length;r++){for(var n=[t],i=2;i<arguments.length;i++)n.push(arguments[i]);try{s.collection[e][r].apply(s.collection,n)}catch(e){}}}};return s},d.translations={en:{gbr:{locality:"Town/City",region:"County",postal_code:"Post code"},usa:{locality:"City",region:"State",postal_code:"Zip code"}}},d.ua={banner:{show:function(e){var t=o.querySelector(".ua-banner");if(!t){var r=o.querySelector("body").firstChild;(t=o.createElement("div")).classList.add("ua-banner"),r.parentNode.insertBefore(t,r.nextSibling)}t.innerHTML=e},hide:function(){var e=o.querySelector(".ua-banner");e&&e.parentNode.removeChild(e)}}},d.urls={endpoint:"https://api.experianaperture.io/address/search/v1",construct:{address:{searchUrl:function(){return d.urls.endpoint},searchData:function(e){var t={country_iso:e.currentCountryCode,components:{unspecified:[e.currentSearchTerm]},dataset:e.currentDataSet,max_suggestions:e.maxSize||e.picklist.maxSize};return e.elements.location&&(t.location=e.elements.location),JSON.stringify(t)}}},getToken:function(e){e.token||(e.token=d.urls.getParameter("token"))},getParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}},d.address=function(e){var p=d.mergeDefaultOptions(e);return p.events=new d.eventFactory,p.init=function(){if(d.urls.getToken(p),!p.token)return p.enabled=!1,void d.ua.banner.show("<a href='https://github.com/experianplc/Experian-Address-Validation#tokens'>Please provide a token for Experian Address Validation.</a>");p.hasSearchInputBeenReset=!0,p.setCountryList(),p.elements.input&&(p.input=p.elements.input,p.countryCodeMapping=p.elements.countryCodeMapping||{},p.input.addEventListener("keyup",p.search),p.input.addEventListener("keydown",p.checkTab),p.input.addEventListener("click",function(e){e.stopPropagation()}),p.input.setAttribute("placeholder",p.placeholderText),p.input.parentNode.setAttribute("autocomplete","off"),p.input.parentNode.addEventListener("submit",function(e){e.preventDefault()}),p.applyFocus&&p.input.focus()),s.addEventListener("click",function(){p.picklist.hide()})},p.unbind=function(){p.elements.input&&(p.input=p.elements.input,p.input.removeEventListener("keyup",p.search),p.input.removeEventListener("keydown",p.checkTab),p.input.parentNode.removeAttribute("autocomplete"))},p.search=function(e){var t=e||s.event;if(38!==(t=t.which||t.keyCode)&&40!==t&&13!==t){p.currentSearchTerm=p.input.value;var r=p.countryCodeMapping[p.countryList.value]||p.countryList.value;if(r=r.split(";"),p.currentCountryCode=r[0],p.currentDataSet=r[1]||"",""===p.currentSearchTerm&&(p.hasSearchInputBeenReset=!0),p.canSearch()){p.request.currentRequest&&p.request.currentRequest.abort(),p.events.trigger("pre-search",p.currentSearchTerm);var n=d.urls.construct.address.searchUrl(),i=d.urls.construct.address.searchData(p);p.lastSearchTerm=p.currentSearchTerm,p.result.hide(),p.searchSpinner.hide(),p.searchSpinner.show(),p.request.send(n,"POST",p.picklist.show,i)}else p.lastSearchTerm!==p.currentSearchTerm&&p.picklist.hide()}else p.picklist.keyup(t)},p.setCountryList=function(){p.countryList=p.elements.countryList,p.countryList||p.createCountryDropdown()},p.canSearch=function(){return p.enabled&&""!==p.currentSearchTerm&&p.lastSearchTerm!==p.currentSearchTerm&&p.countryList.value!==r&&""!==p.countryList.value&&!0===p.hasSearchInputBeenReset},p.checkTab=function(e){var t=e||s.event;9!==(t=t.which||t.keyCode)||p.picklist.keyup(t)},p.createCountryDropdown=function(){p.countryList={}},p.format=function(e){p.events.trigger("pre-formatting-search",e),p.searchSpinner.hide(),p.currentFormatUrl=e,p.request.send(p.currentFormatUrl,"GET",p.result.show)},p.picklist={size:0,maxSize:25,show:function(e){p.picklist.items=e.result.suggestions,p.picklist.currentItem=null,p.picklist.size=p.picklist.items.length,p.picklist.list=p.picklist.list||p.picklist.createList(),p.picklist.list.innerHTML="",p.picklist.resetTabCount(),p.searchSpinner.hide(),p.manualEntry.visible&&(p.picklist.useAddressEntered.element=p.picklist.useAddressEntered.element||p.picklist.useAddressEntered.create(),p.picklist.list.parentNode.classList.add("has-content")),0<p.picklist.size?(p.events.trigger("pre-picklist-create",p.picklist.items),p.infoAlert.visible&&e.result.more_results_available?p.picklist.infoAlert.element=p.picklist.infoAlert.element||p.picklist.infoAlert.create():p.picklist.infoAlert.destroy(),p.picklist.items.forEach(function(e){var t=p.picklist.createListItem(e);p.picklist.list.appendChild(t),p.picklist.listen(t)}),p.picklist.list.parentNode.classList.add("has-content"),p.events.trigger("post-picklist-create",e.result)):(p.picklist.list.parentNode.classList.remove("has-content"),p.infoAlert.visible&&p.picklist.infoAlert.destroy(),p.events.trigger("picklist-empty",e.result))},hide:function(){p.picklist.currentItem=null,p.picklist.useAddressEntered.destroy(),p.picklist.infoAlert.destroy(),p.picklist.list&&(p.input.parentNode.removeChild(p.picklist.container),p.picklist.list=r)},infoAlert:{create:function(){var e=o.createElement("div");e.setAttribute("class","more-results-available alert alert-info");var t=o.createTextNode(p.infoAlert.text);if(e.appendChild(t),p.picklist.list.parentNode.insertBefore(e,p.picklist.list),p.infoAlert.popoverBtn&&p.infoAlert.popoverBtn.visible){var r=o.createElement("a");r.setAttribute("class","btn btn-info"),r.setAttribute("tabindex","0"),r.setAttribute("role","button"),r.setAttribute("data-toggle","popover"),r.setAttribute("title",p.infoAlert.popoverBtn.title),r.setAttribute("data-content",p.infoAlert.popoverBtn.text),r.innerHTML=p.infoAlert.popoverBtn.icon,e.appendChild(r),$(".more-results-available .btn").popover()}return e},destroy:function(){p.picklist.infoAlert.element&&(p.picklist.list.parentNode.removeChild(p.picklist.infoAlert.element),p.picklist.infoAlert.element=r)}},useAddressEntered:{create:function(){var e={text:p.manualEntry.text,format:""},t=p.picklist.createListItem(e);return t.classList.add("use-address-entered"),p.picklist.list.parentNode.insertBefore(t,p.picklist.list.nextSibling),t.addEventListener("click",p.picklist.useAddressEntered.click),t},destroy:function(){p.picklist.useAddressEntered.element&&(p.picklist.list.parentNode.removeChild(p.picklist.useAddressEntered.element),p.picklist.useAddressEntered.element=r)},click:function(){var e={result:{address:{address_line_1:"",address_line_2:"",address_line_3:"",locality:"",region:"",postal_code:"",country:""}}};if(p.currentSearchTerm){var t=p.currentSearchTerm.split(",");t[0]&&(e.result.address.address_line_1=t[0]),t[1]&&(e.result.address.address_line_2=t[1]),t[2]&&(e.result.address.address_line_3=t[2]);for(var r=3;r<t.length;r++)e.result.address.address_line_3+=t[r]}p.result.show(e),p.result.updateHeading(p.formattedAddressContainer.manualHeadingText),p.events.trigger("manual-entry")},formatManualAddressLine:function(e,t){var r={};return r[d.defaults.addressLineLabels[t]]=e[t]||"",r}},createList:function(){var e=o.createElement("div");e.classList.add("address-picklist-container"),e.addEventListener("click",function(e){e.stopPropagation()}),p.input.parentNode.insertBefore(e,p.input.nextSibling),p.picklist.container=e;var t=o.createElement("div");return t.classList.add("address-picklist"),e.appendChild(t),t.addEventListener("keydown",p.picklist.enter),t},createListItem:function(e){var t=o.createElement("div");return t.innerHTML=p.picklist.addMatchingEmphasis(e),t.setAttribute("format",e.format),t},tabCount:-1,resetTabCount:function(){p.picklist.tabCount=-1},keyup:function(e){if(p.picklist.list)if(13!==e&&9!==e){var t,r,n=p.picklist.list.querySelectorAll("div");if(0!==n.length){38===e?p.picklist.tabCount--:p.picklist.tabCount++,p.picklist.tabCount<0&&(p.picklist.tabCount=n.length-1,r=!0),p.picklist.tabCount>n.length-1&&(t=!(p.picklist.tabCount=0));var i=n[p.picklist.tabCount],s=p.picklist.list.querySelector(".selected");s&&s.classList.remove("selected"),i.classList.add("selected"),p.picklist.currentItem=i;var a=p.picklist.list.offsetTop,l=p.picklist.list.offsetTop+p.picklist.list.offsetHeight,o=p.picklist.list.scrollTop,d=i.offsetTop,u=i.offsetTop+i.offsetHeight,c=i.offsetHeight;t?p.picklist.list.scrollTop=0:r?p.picklist.list.scrollTop=999:l<u+c?p.picklist.list.scrollTop=o+c:d-c-a<o&&(p.picklist.list.scrollTop=o-c)}}else p.picklist.checkEnter()},addMatchingEmphasis:function(e){var t="";e.dataset&&(t="["+e.dataset+"]");for(var r=e.matched||[],n=t+e.text,i=0;i<r.length;i++){var s="<b>"+n.substring(r[i][0],r[i][1])+"</b>";n=n.substring(0,r[i][0])+s+n.substring(r[i][1])}return n},listen:function(e){e.addEventListener("click",p.picklist.pick.bind(null,e))},checkEnter:function(){var e;1===p.picklist.size?e=p.picklist.list.querySelectorAll("div")[0]:p.picklist.currentItem&&(e=p.picklist.currentItem),e&&p.picklist.pick(e)},pick:function(e){p.events.trigger("post-picklist-selection",e),p.format(e.getAttribute("format"))}},p.result={show:function(e){if(p.searchSpinner.hide(),p.picklist.hide(),p.input.value="",e.result.address){for(var t in p.result.formattedAddressContainer=p.elements.formattedAddressContainer,!p.result.formattedAddressContainer&&p.result.generateAddressLineRequired&&p.result.createFormattedAddressContainer(),p.result.updateAddressLine("address_line_1",e.result.address.address_line_1,"address-line-input"),p.result.updateAddressLine("address_line_2",e.result.address.address_line_2,"address-line-input"),p.result.updateAddressLine("address_line_3",e.result.address.address_line_3,"address-line-input"),p.result.updateAddressLine("locality",e.result.address.locality,"address-line-input"),p.result.updateAddressLine("region",e.result.address.region,"address-line-input"),p.result.updateAddressLine("postal_code",e.result.address.postal_code,"address-line-input"),p.result.updateAddressLine("country",e.result.address.country,"address-line-input"),p.result.hideSearchInputs(),p.result.createSearchAgainLink(),p.elements)if(p.elements.hasOwnProperty(t)&&"input"!==t&&p.elements[t]===p.elements.input){p.hasSearchInputBeenReset=!1;break}}p.events.trigger("post-formatting-search",e)},hide:function(){for(var e in p.result.formattedAddressContainer&&(p.input.parentNode.removeChild(p.result.formattedAddressContainer),p.result.formattedAddressContainer=r),p.searchAgain.link&&(p.searchAgain.link.parentNode.removeChild(p.searchAgain.link),p.searchAgain.link=r),p.elements)if(p.elements.hasOwnProperty(e))for(var t=0;t<d.defaults.addressLineLabels.length;t++){if(d.defaults.addressLineLabels[t]===e&&p.elements[e]!==p.elements.input){p.elements[e].value="";break}}},createFormattedAddressContainer:function(){var e=o.createElement("div");e.classList.add("formatted-address"),p.input.parentNode.insertBefore(e,p.input.nextSibling),p.result.formattedAddressContainer=e},createHeading:function(){if(p.formattedAddressContainer.showHeading){var e=o.createElement(p.formattedAddressContainer.headingType);e.innerHTML=p.formattedAddressContainer.validatedHeadingText,p.result.formattedAddressContainer.appendChild(e)}},updateHeading:function(e){p.formattedAddressContainer.showHeading&&(p.result.formattedAddressContainer.querySelector(p.formattedAddressContainer.headingType).innerHTML=e)},updateAddressLine:function(e,t,r){if(p.elements[e]){var n=p.elements[e];p.result.updateLabel(e);var i=t;n.value&&i&&(i=", "+i),"INPUT"===n.nodeName||"TEXTAREA"===n.nodeName||"SELECT"===n.nodeName?n.value+=i:n.innerText+=i,p.result.lastAddressField=n}},updateLabel:function(e){var t=e,r=p.language.toLowerCase(),n=p.currentCountryCode.toLowerCase(),i=d.translations;if(i)try{var s=i[r][n][e];if(s){t=s;for(var a=o.getElementsByTagName("label"),l=0;l<a.length;l++)a[l].htmlFor===e&&(a[l].innerHTML=s)}}catch(e){}return t},createSearchAgainLink:function(){if(p.searchAgain.visible){var e=o.createElement("a");e.setAttribute("href","#"),e.classList.add("search-again-link"),e.innerHTML=p.searchAgain.text,e.addEventListener("click",p.reset),p.searchAgain.link=e,p.result.formattedAddressContainer?p.result.formattedAddressContainer.appendChild(e):p.result.lastAddressField.parentNode.insertBefore(e,p.result.lastAddressField.nextSibling)}},renderInputList:function(e){if(0<e.length)for(var t=0;t<e.length;t++)p.result.formattedAddressContainer.appendChild(e[t])},hideSearchInputs:function(){p.toggleVisibility(p.input.parentNode)}},p.toggleVisibility=function(e){for(var t=(e=e||o).querySelectorAll(".toggle"),r=0;r<t.length;r++)t[r].classList.contains("hidden")?t[r].classList.remove("hidden"):t[r].classList.add("hidden")},p.searchSpinner={show:function(){if(p.useSpinner){var e=o.createElement("div");e.classList.add("loader"),e.classList.add("loader-inline");var t=o.createElement("div");t.classList.add("spinner"),e.appendChild(t),p.input.parentNode.insertBefore(e,p.input.nextSibling)}},hide:function(){if(p.useSpinner){var e=p.input.parentNode.querySelector(".loader-inline");e&&p.input.parentNode.removeChild(e)}}},p.reset=function(e){e&&e.preventDefault(),p.enabled=!0,p.result.hide(),p.input.value="",p.hasSearchInputBeenReset=!0,p.toggleVisibility(p.input.parentNode),p.input.focus(),p.events.trigger("post-reset")},p.handleError={badRequest:function(e){p.enabled=!1,p.handleError.showSubmitButton(),p.events.trigger("request-error-400",e)},unauthorized:function(e){p.enabled=!1,p.handleError.showSubmitButton(),p.events.trigger("request-error-401",e)},forbidden:function(e){p.enabled=!1,p.handleError.showSubmitButton(),p.events.trigger("request-error-403",e)},notFound:function(e){p.enabled=!1,p.handleError.showSubmitButton(),p.events.trigger("request-error-404",e)},showSubmitButton:function(){var e=o.createElement("button");e.innerText="Submit",p.input.parentNode.insertBefore(e,p.input.nextSibling),e.addEventListener("click",function(){p.picklist.useAddressEntered.click(),p.input.parentNode.removeChild(e)})}},p.request={currentRequest:null,send:function(e,t,r,n){p.request.currentRequest=new XMLHttpRequest,p.request.currentRequest.open(t,e,!0),p.request.currentRequest.timeout=5e3,p.request.currentRequest.setRequestHeader("auth-token",p.token),p.request.currentRequest.setRequestHeader("Content-Type","application/json"),p.request.currentRequest.setRequestHeader("Accept","application/json"),p.request.currentRequest.onload=function(e){if(200<=p.request.currentRequest.status&&p.request.currentRequest.status<400){var t=JSON.parse(p.request.currentRequest.responseText);p.request.latestResult=t,r(t)}else p.request.latestResult={},p.searchSpinner.hide(),p.events.trigger("request-error",e),400===p.request.currentRequest.status?p.handleError.badRequest(e):401===p.request.currentRequest.status?p.handleError.unauthorized(e):403===p.request.currentRequest.status?p.handleError.forbidden(e):404===p.request.currentRequest.status&&p.handleError.notFound(e)},p.request.currentRequest.onerror=function(e){p.searchSpinner.hide(),p.events.trigger("request-error",e)},p.request.currentRequest.ontimeout=function(e){p.searchSpinner.hide(),p.events.trigger("request-timeout",e)},p.request.currentRequest.send(n)}},p.init(),p}}(window,window.document);